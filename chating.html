<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<title>meichat</title>
	<script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
	<link rel="stylesheet" type="text/css" href="style.css" />
	<style>
		

		#chat {
			height: 80vh;
			overflow-y: auto;
			padding: 5px;
			margin-bottom: 10px;
			background: #00000075;
		}

		#msgInput,
		#nameInput {
			width: 100%;
			padding: 8px;
			box-sizing: border-box;
			border-radius: 5px;
			border-style: none;
			background-color: #00000075;
			color: #ccc;
		}

		.msg {
			padding: 2px 0;
		}
	</style>
</head>

<body>
	<div class="page-container">
		<div id="toast-container"></div>
		<nav id="nav-placeholder"></nav>
		<script src="js/loadNav.js"></script>
		<div id="chat"></div>
		<input id="msgInput" type="text" placeholder="type a message and hit enter...">
		<div style="height: 10px;"></div>
		<input id="nameInput" type="text" placeholder="your name here">
		<p id="alerter"></p>

		<script>
			function parseColors(msg) {
				return msg.replace(/<#[0-9A-Fa-f]{6}>(.*?)<\/>/g, (full, text) => {
					const color = full.slice(1, 8); // "#FF0000"
					return `<span style="color:${color}">${text}</span>`;
				});
			}

			function escapeHtml(str) {
				return str.replace(/[&<>"']/g, match => ({
					'&': '&amp;',
					'<': '&lt;',
					'>': '&gt;',
					'"': '&quot;',
					"'": '&#39;'
				}[match]));
			}

		</script>

		<script>
			const socket = io("https://api.meisite.xyz/");
			const chat = document.getElementById('chat');
			const input = document.getElementById('msgInput');
			const nameinput = document.getElementById('nameInput');
			const alerter = document.getElementById('alerter');
			let name = "";
			let lastmessage = "";

			socket.on('message', (msg) => {
				const div = document.createElement('div');
				div.className = 'msg';
				div.innerHTML = parseColors(msg);
				chat.appendChild(div);
				chat.scrollTop = chat.scrollHeight; // auto-scroll down
			});

			input.addEventListener('keydown', (e) => {
				if (e.key === 'Enter' && input.value.trim() !== '') {
					socket.send(input.value);
					lastmessage = input.value;
					input.value = '';
					if (name == "") {
						alerter.innerText = 'You need to set a name first.';
					}
				}
				if (e.key === 'ArrowUp') {
					input.value = lastmessage;
				}
			});

			nameinput.addEventListener('keydown', (e) => {
				if (e.key === 'Enter' && nameinput.value.trim() !== '') {
					socket.send("-NAME-= " + nameinput.value);
					name = nameinput.value;
					alerter.innerText = 'Name set to: ' + name;
				}
			});


		</script>
		<footer style="font-family: monospace;" id="footer-placeholder"></footer>
		<script src="js/loadFooter.js"></script>
	</div>
</body>

</html>